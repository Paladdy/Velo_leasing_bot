# üí≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¢–æ—á–∫–∞ –ë–∞–Ω–∫–æ–º –¥–ª—è –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç—ã –ø—Ä–æ–¥–ª–µ–Ω–∏—è –∞—Ä–µ–Ω–¥—ã –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤.

## –¢–∞—Ä–∏—Ñ—ã

| –ü–µ—Ä–∏–æ–¥ | –¶–µ–Ω–∞ | –î–Ω–µ–π |
|--------|------|------|
| 2 –Ω–µ–¥–µ–ª–∏ | 6 500 ‚ÇΩ | 14 |
| –ú–µ—Å—è—Ü | 12 600 ‚ÇΩ | 30 |

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¢–æ—á–∫–∏

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞: https://i.tochka.com
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–°–µ—Ä–≤–∏—Å—ã¬ª ‚Üí ¬´–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ API¬ª
3. –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é ¬´–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ API¬ª
4. –ù–∞–∂–º–∏—Ç–µ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å JWT-–∫–ª—é—á¬ª –∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª—é—á–∞
5. –í—ã–¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø—ã –¥–ª—è –ò–ü/–û–û–û –Ω–∞:
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–ø–ª–∞—Ç—É
6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è ¬´–ë–µ—Å—Å—Ä–æ—á–Ω–æ¬ª
7. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å –ø–æ–º–æ—â—å—é SMS-–∫–æ–¥–∞
8. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JWT —Ç–æ–∫–µ–Ω

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ CustomerCode

CustomerCode ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞.
–ï–≥–æ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö API –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# JWT —Ç–æ–∫–µ–Ω –¥–ª—è API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
TOCHKA_JWT_TOKEN=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...–≤–∞—à_—Ç–æ–∫–µ–Ω

# –ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞
TOCHKA_CUSTOMER_CODE=–≤–∞—à_customer_code

# ID —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞)
TOCHKA_MERCHANT_ID=
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

**–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: Polling (–±–µ–∑ webhook)**

–ö–ª–∏–µ–Ω—Ç —Å–∞–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –∫–Ω–æ–ø–∫–æ–π "‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª".
–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞!

```
–ö–ª–∏–µ–Ω—Ç ‚Üí –û–ø–ª–∞—Ç–∞ –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "–Ø –æ–ø–ª–∞—Ç–∏–ª" ‚Üí –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å ‚Üí –ü—Ä–æ–¥–ª–µ–Ω–∏–µ
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

1. **üìã –ú–æ–∏ –∞—Ä–µ–Ω–¥—ã** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—Ä–µ–Ω–¥
2. **–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω** - –≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ –∏ –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –¢–æ—á–∫–∞ –ë–∞–Ω–∫
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞** - –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞

### –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã

```
–ö–ª–∏–µ–Ω—Ç -> "üìã –ú–æ–∏ –∞—Ä–µ–Ω–¥—ã" -> –í—ã–±–æ—Ä –∞—Ä–µ–Ω–¥—ã -> –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ -> –û–ø–ª–∞—Ç–∞ -> –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
```

1. –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç "üìã –ú–æ–∏ –∞—Ä–µ–Ω–¥—ã"
2. –í—ã–±–∏—Ä–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –∞—Ä–µ–Ω–¥—É –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è
3. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ (2 –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –º–µ—Å—è—Ü)
4. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–µ
5. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –∞—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è

## –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `services/payment_service.py` | –°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ |
| `bot/handlers/client/extension.py` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –∞—Ä–µ–Ω–¥—ã |
| `config/settings.py` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¢–æ—á–∫–∏ |

## API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏

```python
from services.payment_service import rental_extension_service

payment = await rental_extension_service.create_extension_payment(
    rental_id=123,
    tariff_key="biweekly",  # –∏–ª–∏ "monthly"
    telegram_user_id=456
)

# URL –¥–ª—è –æ–ø–ª–∞—Ç—ã
confirmation_url = payment["confirmation"]["confirmation_url"]
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```python
status = await rental_extension_service.check_payment_status(payment_id)
# "pending", "succeeded", "canceled"
```

## Docker

```yaml
# docker-compose.yml
environment:
  TOCHKA_JWT_TOKEN: "–≤–∞—à_jwt_—Ç–æ–∫–µ–Ω"
  TOCHKA_CUSTOMER_CODE: "–≤–∞—à_customer_code"
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ –≤ –∫–æ–¥–µ
- Webhook URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—â–∏—â—ë–Ω HTTPS (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å reverse proxy (nginx) –ø–µ—Ä–µ–¥ webhook —Å–µ—Ä–≤–µ—Ä–æ–º

## –ú–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã

–¢–æ—á–∫–∞ –ë–∞–Ω–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã (Visa, MasterCard, –ú–ò–†)
- –°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (–°–ë–ü)

## –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–∫—É–ø–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞
- [ ] –ü–æ–¥–ø–∏—Å–∫–∏ —Å –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞–º–∏
- [ ] –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –°–ë–ü QR-–∫–æ–¥–æ–≤

